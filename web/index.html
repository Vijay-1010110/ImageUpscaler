<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImageUpscaler â€” AI Super Resolution</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a28;
            --bg-hover: #22223a;
            --border: #2a2a40;
            --border-glow: #6c5ce7;
            --text-primary: #f0f0f8;
            --text-secondary: #8888a8;
            --accent: #6c5ce7;
            --accent-light: #a29bfe;
            --accent-glow: rgba(108, 92, 231, 0.3);
            --success: #00e676;
            --danger: #ff5252;
            --gradient-1: linear-gradient(135deg, #6c5ce7, #a29bfe);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at 30% 20%, rgba(108, 92, 231, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(162, 155, 254, 0.04) 0%, transparent 50%);
            pointer-events: none;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 10, 15, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: var(--gradient-1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-badge {
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(108, 92, 231, 0.1);
            border: 1px solid rgba(108, 92, 231, 0.3);
            font-size: 12px;
            color: var(--accent-light);
            font-weight: 500;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px;
        }

        /* Drop Zone */
        .dropzone {
            position: relative;
            border: 2px dashed var(--border);
            border-radius: 20px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: var(--bg-secondary);
            margin-bottom: 32px;
        }

        .dropzone::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-1);
            opacity: 0;
            transition: opacity 0.4s;
            border-radius: 18px;
        }

        .dropzone:hover,
        .dropzone.drag-over {
            border-color: var(--accent);
            box-shadow: 0 0 40px var(--accent-glow);
        }

        .dropzone:hover::before,
        .dropzone.drag-over::before {
            opacity: 0.05;
        }

        .dropzone-content {
            position: relative;
            z-index: 1;
        }

        .dropzone-icon {
            font-size: 56px;
            margin-bottom: 16px;
            display: block;
        }

        .dropzone-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .dropzone-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .dropzone-subtitle span {
            color: var(--accent-light);
            font-weight: 500;
            cursor: pointer;
        }

        #fileInput {
            display: none;
        }

        /* Processing */
        .processing {
            display: none;
            text-align: center;
            padding: 48px;
        }

        .processing.active {
            display: block;
        }

        .spinner {
            width: 56px;
            height: 56px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .processing-text {
            font-size: 16px;
            color: var(--text-secondary);
        }

        /* Controls */
        .controls-bar {
            display: none;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 14px 20px;
            background: var(--bg-card);
            border-radius: 14px;
            border: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 12px;
        }

        .controls-bar.active {
            display: flex;
        }

        .info-pills {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .pill {
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            background: rgba(108, 92, 231, 0.1);
            border: 1px solid rgba(108, 92, 231, 0.2);
            color: var(--accent-light);
        }

        .pill.success {
            background: rgba(0, 230, 118, 0.1);
            border-color: rgba(0, 230, 118, 0.2);
            color: var(--success);
        }

        .control-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 18px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background: var(--bg-hover);
            border-color: var(--accent);
        }

        .btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff;
        }

        .btn-primary {
            background: var(--gradient-1);
            border: none;
            color: #fff;
        }

        .btn-primary:hover {
            box-shadow: 0 4px 20px var(--accent-glow);
            transform: translateY(-1px);
        }

        /* Compare Container */
        .compare-container {
            display: none;
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
            background: #000;
            height: 70vh;
            min-height: 450px;
        }

        .compare-container.active {
            display: block;
        }

        /* === SIDE BY SIDE === */
        .sbs-view {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .sbs-pane {
            flex: 1;
            position: relative;
            overflow: hidden;
            cursor: grab;
        }

        .sbs-pane:active {
            cursor: grabbing;
        }

        .sbs-pane+.sbs-pane {
            border-left: 1px solid var(--border);
        }

        .sbs-pane canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        /* === SLIDER VIEW === */
        .slider-view {
            display: none;
            position: relative;
            width: 100%;
            height: 100%;
            cursor: grab;
            overflow: hidden;
        }

        .slider-view:active {
            cursor: grabbing;
        }

        .slider-view canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        .slider-handle {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 3px;
            background: #fff;
            z-index: 5;
            cursor: ew-resize;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.5);
            transform: translateX(-50%);
        }

        .slider-handle::after {
            content: 'âŸ¨ âŸ©';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-size: 14px;
            font-weight: 700;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.4);
        }

        /* Labels */
        .pane-label {
            position: absolute;
            top: 14px;
            z-index: 10;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            backdrop-filter: blur(12px);
            pointer-events: none;
        }

        .pane-label.original {
            left: 14px;
            background: rgba(255, 82, 82, 0.2);
            border: 1px solid rgba(255, 82, 82, 0.3);
            color: #ff8a80;
        }

        .pane-label.upscaled {
            right: 14px;
            background: rgba(0, 230, 118, 0.2);
            border: 1px solid rgba(0, 230, 118, 0.3);
            color: #69f0ae;
        }

        /* Zoom indicator */
        .zoom-indicator {
            position: absolute;
            bottom: 14px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            padding: 6px 16px;
            border-radius: 8px;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .footer {
            text-align: center;
            padding: 32px;
            color: var(--text-secondary);
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .controls-bar {
                flex-direction: column;
            }

            .header {
                padding: 12px 16px;
            }
        }
    </style>
</head>

<body>

    <header class="header">
        <div class="logo">
            <div class="logo-icon">ðŸ”¬</div>
            <span class="logo-text">ImageUpscaler</span>
        </div>
        <div class="header-badge">AI Super Resolution</div>
    </header>

    <div class="container">

        <div id="dropzoneWrapper">
            <div class="dropzone" id="dropzone">
                <div class="dropzone-content">
                    <span class="dropzone-icon">ðŸ“¸</span>
                    <div class="dropzone-title">Drop your image here</div>
                    <div class="dropzone-subtitle">or <span
                            onclick="document.getElementById('fileInput').click()">browse files</span> â€” PNG, JPG, WEBP
                    </div>
                </div>
            </div>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div class="processing" id="processing">
            <div class="spinner"></div>
            <div class="processing-text">Upscaling your image with AI...</div>
        </div>

        <div class="controls-bar" id="controlsBar">
            <div class="info-pills" id="infoPills"></div>
            <div class="control-btns">
                <button class="btn active" id="btnSbs" onclick="setMode('sbs')">â—§ Side by Side</button>
                <button class="btn" id="btnSlider" onclick="setMode('slider')">â‡” Slider</button>
                <button class="btn" id="btnResetZoom" onclick="resetView()">âŠ• Reset Zoom</button>
                <button class="btn btn-primary" id="btnDownload" onclick="downloadResult()">â†“ Download</button>
                <button class="btn" onclick="uploadNew()">+ New</button>
            </div>
        </div>

        <div class="compare-container" id="compareContainer">

            <!-- Side by Side: two canvases -->
            <div class="sbs-view" id="sbsView">
                <div class="sbs-pane" id="paneLeft">
                    <span class="pane-label original">Original</span>
                    <canvas id="canvasLeft"></canvas>
                </div>
                <div class="sbs-pane" id="paneRight">
                    <span class="pane-label upscaled">Upscaled</span>
                    <canvas id="canvasRight"></canvas>
                </div>
            </div>

            <!-- Slider: two canvases overlaid -->
            <div class="slider-view" id="sliderView">
                <span class="pane-label original">Original</span>
                <span class="pane-label upscaled">Upscaled</span>
                <canvas id="canvasSliderBg"></canvas>
                <canvas id="canvasSliderFg"></canvas>
                <div class="slider-handle" id="sliderHandle"></div>
            </div>

            <div class="zoom-indicator" id="zoomIndicator">100%</div>
        </div>

    </div>

    <footer class="footer">
        Built with PyTorch Â· AI-Powered Super Resolution
    </footer>

    <script>
        (function () {
            // â”€â”€â”€ State â”€â”€â”€
            const S = {
                mode: 'sbs',             // 'sbs' or 'slider'
                imgOriginal: null,       // Image objects
                imgUpscaled: null,
                refW: 0,                 // Reference dimensions (upscaled image size)
                refH: 0,
                zoom: 1,
                panX: 0,
                panY: 0,
                isPanning: false,
                panStartX: 0,
                panStartY: 0,
                sliderPos: 0.5,          // 0..1
                isSliding: false,
                upscaledUrl: '',
                zoomTimer: null,
            };

            // â”€â”€â”€ DOM refs â”€â”€â”€
            const dropzone = document.getElementById('dropzone');
            const fileInput = document.getElementById('fileInput');
            const dropzoneWrapper = document.getElementById('dropzoneWrapper');
            const processing = document.getElementById('processing');
            const controlsBar = document.getElementById('controlsBar');
            const compareContainer = document.getElementById('compareContainer');
            const sbsView = document.getElementById('sbsView');
            const sliderView = document.getElementById('sliderView');
            const zoomIndicator = document.getElementById('zoomIndicator');
            const sliderHandle = document.getElementById('sliderHandle');

            const canvasLeft = document.getElementById('canvasLeft');
            const canvasRight = document.getElementById('canvasRight');
            const canvasSliderBg = document.getElementById('canvasSliderBg');
            const canvasSliderFg = document.getElementById('canvasSliderFg');
            const ctxLeft = canvasLeft.getContext('2d');
            const ctxRight = canvasRight.getContext('2d');
            const ctxBg = canvasSliderBg.getContext('2d');
            const ctxFg = canvasSliderFg.getContext('2d');

            // â”€â”€â”€ Drag & Drop â”€â”€â”€
            ['dragenter', 'dragover'].forEach(e =>
                dropzone.addEventListener(e, ev => { ev.preventDefault(); dropzone.classList.add('drag-over'); })
            );
            ['dragleave', 'drop'].forEach(e =>
                dropzone.addEventListener(e, ev => { ev.preventDefault(); dropzone.classList.remove('drag-over'); })
            );
            dropzone.addEventListener('drop', e => {
                const f = e.dataTransfer.files[0];
                if (f && f.type.startsWith('image/')) uploadImage(f);
            });
            dropzone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', e => { if (e.target.files[0]) uploadImage(e.target.files[0]); });

            // â”€â”€â”€ Upload â”€â”€â”€
            async function uploadImage(file) {
                dropzoneWrapper.style.display = 'none';
                processing.classList.add('active');

                const formData = new FormData();
                formData.append('image', file);

                try {
                    const res = await fetch('/upscale', { method: 'POST', body: formData });
                    const data = await res.json();
                    if (data.error) { alert(data.error); uploadNew(); return; }

                    S.upscaledUrl = data.upscaled;

                    // Load both images
                    const [imgOrig, imgUp] = await Promise.all([
                        loadImage(data.original),
                        loadImage(data.upscaled)
                    ]);

                    S.imgOriginal = imgOrig;
                    S.imgUpscaled = imgUp;

                    // Use the upscaled image dimensions as the reference
                    // Both images will be drawn at this size
                    S.refW = imgUp.naturalWidth;
                    S.refH = imgUp.naturalHeight;

                    document.getElementById('infoPills').innerHTML = `
                    <div class="pill">Input: ${data.original_size}</div>
                    <div class="pill success">Output: ${data.upscaled_size}</div>
                    <div class="pill">${data.scale}x Upscale</div>
                `;

                    processing.classList.remove('active');
                    controlsBar.classList.add('active');
                    compareContainer.classList.add('active');

                    setMode('sbs');

                } catch (err) {
                    alert('Error: ' + err.message);
                    uploadNew();
                }
            }

            function loadImage(src) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = src;
                });
            }

            window.uploadNew = function () {
                processing.classList.remove('active');
                dropzoneWrapper.style.display = 'block';
                controlsBar.classList.remove('active');
                compareContainer.classList.remove('active');
                fileInput.value = '';
            };

            // â”€â”€â”€ View mode â”€â”€â”€
            window.setMode = function (mode) {
                S.mode = mode;
                document.getElementById('btnSbs').classList.toggle('active', mode === 'sbs');
                document.getElementById('btnSlider').classList.toggle('active', mode === 'slider');
                sbsView.style.display = mode === 'sbs' ? 'flex' : 'none';
                sliderView.style.display = mode === 'slider' ? 'block' : 'none';
                resetView();
            };

            // â”€â”€â”€ Reset view to fit â”€â”€â”€
            window.resetView = function () {
                if (!S.imgUpscaled) return;

                let cw, ch;
                if (S.mode === 'sbs') {
                    // Each pane is half the container
                    cw = compareContainer.clientWidth / 2;
                    ch = compareContainer.clientHeight;
                } else {
                    cw = compareContainer.clientWidth;
                    ch = compareContainer.clientHeight;
                }

                // Fit the reference image into the container
                S.zoom = Math.min(cw / S.refW, ch / S.refH, 1);
                S.panX = (cw - S.refW * S.zoom) / 2;
                S.panY = (ch - S.refH * S.zoom) / 2;
                S.sliderPos = 0.5;
                sliderHandle.style.left = '50%';

                render();
                showZoom();
            };

            // â”€â”€â”€ Render â”€â”€â”€
            function render() {
                if (S.mode === 'sbs') renderSbs();
                else renderSlider();
            }

            function renderSbs() {
                const paneW = compareContainer.clientWidth / 2;
                const paneH = compareContainer.clientHeight;
                const dpr = window.devicePixelRatio || 1;

                // Size canvases to pane
                [canvasLeft, canvasRight].forEach(c => {
                    c.width = paneW * dpr;
                    c.height = paneH * dpr;
                    c.style.width = paneW + 'px';
                    c.style.height = paneH + 'px';
                });

                // Draw original (stretched to refW x refH so it visually matches the upscaled)
                ctxLeft.setTransform(dpr, 0, 0, dpr, 0, 0);
                ctxLeft.clearRect(0, 0, paneW, paneH);
                ctxLeft.imageSmoothingEnabled = true;
                ctxLeft.imageSmoothingQuality = 'high';
                ctxLeft.drawImage(
                    S.imgOriginal,
                    S.panX, S.panY,
                    S.refW * S.zoom, S.refH * S.zoom
                );

                // Draw upscaled (at its natural size)
                ctxRight.setTransform(dpr, 0, 0, dpr, 0, 0);
                ctxRight.clearRect(0, 0, paneW, paneH);
                ctxRight.imageSmoothingEnabled = false;
                ctxRight.drawImage(
                    S.imgUpscaled,
                    S.panX, S.panY,
                    S.refW * S.zoom, S.refH * S.zoom
                );
            }

            function renderSlider() {
                const cw = compareContainer.clientWidth;
                const ch = compareContainer.clientHeight;
                const dpr = window.devicePixelRatio || 1;
                const splitX = Math.round(S.sliderPos * cw);

                [canvasSliderBg, canvasSliderFg].forEach(c => {
                    c.width = cw * dpr;
                    c.height = ch * dpr;
                    c.style.width = cw + 'px';
                    c.style.height = ch + 'px';
                });

                // Background: upscaled (full area)
                ctxBg.setTransform(dpr, 0, 0, dpr, 0, 0);
                ctxBg.clearRect(0, 0, cw, ch);
                ctxBg.imageSmoothingEnabled = false;
                ctxBg.drawImage(
                    S.imgUpscaled,
                    S.panX, S.panY,
                    S.refW * S.zoom, S.refH * S.zoom
                );

                // Foreground: original (clipped to left of slider)
                ctxFg.setTransform(dpr, 0, 0, dpr, 0, 0);
                ctxFg.clearRect(0, 0, cw, ch);
                ctxFg.save();
                ctxFg.beginPath();
                ctxFg.rect(0, 0, splitX, ch);
                ctxFg.clip();
                ctxFg.imageSmoothingEnabled = true;
                ctxFg.imageSmoothingQuality = 'high';
                ctxFg.drawImage(
                    S.imgOriginal,
                    S.panX, S.panY,
                    S.refW * S.zoom, S.refH * S.zoom
                );
                ctxFg.restore();

                sliderHandle.style.left = splitX + 'px';
            }

            function showZoom() {
                zoomIndicator.textContent = Math.round(S.zoom * 100) + '%';
                zoomIndicator.style.opacity = '1';
                clearTimeout(S.zoomTimer);
                S.zoomTimer = setTimeout(() => zoomIndicator.style.opacity = '0', 1500);
            }

            // â”€â”€â”€ Wheel zoom (centered on cursor) â”€â”€â”€
            compareContainer.addEventListener('wheel', e => {
                e.preventDefault();
                if (!S.imgUpscaled) return;

                const rect = getActiveRect();
                const mx = e.clientX - rect.left;
                const my = e.clientY - rect.top;

                // Image coords under cursor
                const imgX = (mx - S.panX) / S.zoom;
                const imgY = (my - S.panY) / S.zoom;

                const factor = e.deltaY > 0 ? 0.9 : 1.1;
                S.zoom = clamp(S.zoom * factor, 0.1, 30);

                // Adjust pan so the point under cursor stays fixed
                S.panX = mx - imgX * S.zoom;
                S.panY = my - imgY * S.zoom;

                render();
                showZoom();
            }, { passive: false });

            // â”€â”€â”€ Pan â”€â”€â”€
            compareContainer.addEventListener('mousedown', e => {
                if (e.target === sliderHandle || e.target.parentElement === sliderHandle) return;
                // Check if near slider line in slider mode
                if (S.mode === 'slider') {
                    const rect = compareContainer.getBoundingClientRect();
                    const mx = e.clientX - rect.left;
                    const splitX = S.sliderPos * rect.width;
                    if (Math.abs(mx - splitX) < 20) {
                        S.isSliding = true;
                        e.preventDefault();
                        return;
                    }
                }
                S.isPanning = true;
                S.panStartX = e.clientX - S.panX;
                S.panStartY = e.clientY - S.panY;
                e.preventDefault();
            });

            window.addEventListener('mousemove', e => {
                if (S.isSliding) {
                    const rect = compareContainer.getBoundingClientRect();
                    S.sliderPos = clamp((e.clientX - rect.left) / rect.width, 0, 1);
                    render();
                    return;
                }
                if (!S.isPanning) return;
                S.panX = e.clientX - S.panStartX;
                S.panY = e.clientY - S.panStartY;
                render();
            });

            window.addEventListener('mouseup', () => {
                S.isPanning = false;
                S.isSliding = false;
            });

            // Slider handle drag
            sliderHandle.addEventListener('mousedown', e => {
                S.isSliding = true;
                e.preventDefault();
                e.stopPropagation();
            });

            // â”€â”€â”€ Touch support â”€â”€â”€
            let lastTouchDist = 0;

            compareContainer.addEventListener('touchstart', e => {
                if (e.touches.length === 1) {
                    S.isPanning = true;
                    S.panStartX = e.touches[0].clientX - S.panX;
                    S.panStartY = e.touches[0].clientY - S.panY;
                } else if (e.touches.length === 2) {
                    S.isPanning = false;
                    lastTouchDist = getTouchDist(e.touches);
                }
            }, { passive: false });

            compareContainer.addEventListener('touchmove', e => {
                e.preventDefault();
                if (e.touches.length === 1 && S.isPanning) {
                    S.panX = e.touches[0].clientX - S.panStartX;
                    S.panY = e.touches[0].clientY - S.panStartY;
                    render();
                } else if (e.touches.length === 2) {
                    const dist = getTouchDist(e.touches);
                    const factor = dist / lastTouchDist;
                    S.zoom = clamp(S.zoom * factor, 0.1, 30);
                    lastTouchDist = dist;
                    render();
                    showZoom();
                }
            }, { passive: false });

            compareContainer.addEventListener('touchend', () => { S.isPanning = false; });

            function getTouchDist(touches) {
                const dx = touches[0].clientX - touches[1].clientX;
                const dy = touches[0].clientY - touches[1].clientY;
                return Math.sqrt(dx * dx + dy * dy);
            }

            // â”€â”€â”€ Helpers â”€â”€â”€
            function getActiveRect() {
                if (S.mode === 'sbs') {
                    // Use the left pane as reference
                    return document.getElementById('paneLeft').getBoundingClientRect();
                }
                return compareContainer.getBoundingClientRect();
            }

            function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }

            // â”€â”€â”€ Resize â”€â”€â”€
            window.addEventListener('resize', () => { if (S.imgUpscaled) render(); });

            // â”€â”€â”€ Download â”€â”€â”€
            window.downloadResult = function () {
                const a = document.createElement('a');
                a.href = S.upscaledUrl;
                a.download = 'upscaled_result.png';
                a.click();
            };

            // â”€â”€â”€ Keyboard shortcuts â”€â”€â”€
            window.addEventListener('keydown', e => {
                if (e.key === '1') setMode('sbs');
                if (e.key === '2') setMode('slider');
                if (e.key === '0') resetView();
                if (e.key === '+' || e.key === '=') { S.zoom = clamp(S.zoom * 1.2, 0.1, 30); render(); showZoom(); }
                if (e.key === '-') { S.zoom = clamp(S.zoom / 1.2, 0.1, 30); render(); showZoom(); }
            });

        })();
    </script>

</body>

</html>